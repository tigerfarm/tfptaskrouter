<!DOCTYPE html>
<html>
    <head>
        <title>TR Worker</title>
        <link href="custom/favicon.ico" rel="shortcut icon" type="image/x-icon">
        <script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
        <script src="https://media.twiliocdn.com/sdk/js/client/releases/1.5.1/twilio.min.js"></script>
        <script type="text/javascript" src="//media.twiliocdn.com/taskrouter/js/v1.20/taskrouter.min.js"></script>
        <!-- script type="text/javascript" src="https://media.twiliocdn.com/taskrouter/js/v2/twilio-taskrouter-worker.min.js"></script -->
        
        <script src="clientTr.js"></script>
        <link rel="stylesheet" href="custom/client.css">
        <script>
            var clientId = "";
            function endConference() {
                $("div.callMessages").html("Please wait, ending conference.");
                logger("End the conference: " + theConference);
                // setButtons("endConference()");
                setButtonEndConference(true);
                $.get("conferenceEndFn.php?conferenceName=" + theConference, function (theResponse) {
                    logger("Response: " + theResponse);
                    theConference = "";
                }).fail(function () {
                    logger("- Error ending conference.");
                    return;
                });
            }
            function setButtonEndConference(value) {
                $('#btn-endconf').prop('disabled', value);
            }
            function clearMessages() {
                $("div.msgClientid").html("Token id: <b>" + clientId + "</b>");
                $("div.msgTokenPassword").html("");
            }
            function logger(message) {
                var log = document.getElementById('log');
                log.value += "\n> " + message;
                log.scrollTop = log.scrollHeight;
            }
            function clearLog() {
                log.value = "+ Ready";
            }
            window.onload = function () {
                var log = document.getElementById('log');
                log.value = "+++ Start.";
                setTrButtons('init');
                setButtonEndConference(true);
            };
        </script>
    </head>
    <body>
        <script type="text/javascript" src="custom/pageTop.js"></script>
        <div id="chatBox" style="height: 260px">
            <div class="panelTitle">
                Worker Dashboard
            </div>
            <div class="panelArea" style="margin-top: 6px;">
                <table>
                    <tr><td>Identity </td><td><input id="clientid" type="text"/></td><td><div class="msgClientid">Set Client ID.</div></td></tr>
                    <tr><td>Password </td><td><input type="password" id="tokenPassword" name="tokenPassword" placeholder="Your access password"/></td><td><div class="msgTokenPassword"></div></tr>
                </table>
            </div>
            <div style="margin-top: 6px;">
                <table>
                    <tr>
                        <td><div style="padding-top: 9px;">WorkSpace: </div></td>
                        <td colspan="5"><div class="trWorkSpace" style="padding-top: 9px;">Not set.</div></td>
                    </tr>
                    <tr>
                        <td><div style="padding-top: 9px;">Worker status: </div></td>
                        <td colspan="5"><div class="trStatus" style="padding-top: 9px;">Requires an access token.</div></td>
                    </tr>
                    <tr style="visibility: visible;">
                        <td><button class="abutton" id="btn-trtoken" onclick="trToken();" style="visibility: visible;">Get access token</button></td>
                        <td><button class="abutton" id="btn-online" onclick="goAvailable();" disabled style="visibility: visible;">Go online</button></td>
                        <td><button class="abutton" id="btn-offline" onclick="goOffline();" disabled style="visibility: visible;">Go offline</button></td>
                        <td><button class="abutton" id="btn-acceptTR" onclick="acceptReservation();" disabled style="visibility: visible;">Accept</button></td>
                        <td><button class="abutton" id="btn-rejectTR" onclick="rejectReservation();" disabled style="visibility: visible;">Reject</button></td>
                        <!-- td><button class="abutton" id="btn-trHangup" onclick="trHangup();" disabled style="visibility: visible;">End reservation</button></td -->
                        <td><button class="abutton" id="btn-endconf" onclick="endConference();" disabled style="visibility: visible;">End conference</button></td>
                    </tr>
                    <tr>
                        <td><div style="padding-top: 9px;">TaskRouter: </div></td>
                        <td colspan="5"><div class="trMessages" style="padding-top: 9px;">Need to refresh the token.</div></td>
                    </tr>
                </table>
            </div>
        </div>
        <div id="logBox">
            <div class="panelTitle">Log messages</div>
            <div class="panelArea">
                <textarea id="log"></textarea>
            </div>
            <div>
                <table>
                    <tr>
                        <td><button class="abutton" id="clearLog" onclick="clearLog();">Clear</button></td>
                    </tr>
                </table>
            </div>
        </div>
        <script type="text/javascript" src="custom/pageBottom.js"></script>
    </body>
</html>